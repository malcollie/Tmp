Sub MatchComponents()

    Dim wsJira As Worksheet
    Dim wsExport As Worksheet
    Dim lastRowJira As Long
    Dim lastRowExport As Long
    Dim jiraRow As Long
    Dim exportRow As Long
    Dim compCol As Long
    Dim issueKey As String
    Dim compValue As String
    Dim result As String

    ' Set the worksheets
    Set wsJira = ThisWorkbook.Sheets("jira")
    Set wsExport = ThisWorkbook.Sheets("export")

    ' Get the last row of each worksheet
    lastRowJira = wsJira.Cells(wsJira.Rows.Count, "B").End(xlUp).Row
    lastRowExport = wsExport.Cells(wsExport.Rows.Count, "A").End(xlUp).Row

    ' Loop through each component in the export worksheet
    For exportRow = 2 To lastRowExport
        ' Get the component value from the export sheet
        compValue = wsExport.Cells(exportRow, 1).Value
        result = ""

        ' Loop through each row in the jira worksheet
        For jiraRow = 2 To lastRowJira
            ' Get the issue key from column B
            issueKey = wsJira.Cells(jiraRow, 2).Value

            ' Loop through each component column (P through EI)
            For compCol = 16 To 139 ' Columns P (16) through EI (139)
                If wsJira.Cells(jiraRow, compCol).Value = compValue Then
                    If result = "" Then
                        result = issueKey
                    Else
                        result = result & ", " & issueKey
                    End If
                    Exit For ' Stop looking in other columns if component is found
                End If
            Next compCol
        Next jiraRow

        ' Put the result in the CX column of the export sheet
        wsExport.Cells(exportRow, 126).Value = result ' Column CX (126)
    Next exportRow

    MsgBox "Macro completed!", vbInformation

End Sub
