Sub CorrelateJiras()
    Dim wsJira As Worksheet
    Dim wsAssets As Worksheet
    Dim lastRowJira As Long
    Dim lastColJira As Long
    Dim lastRowAssets As Long
    Dim i As Long, j As Long, k As Long
    Dim issueKey As String
    Dim component As String
    Dim found As Boolean
    Dim existingValue As String

    ' Set references to the sheets
    Set wsJira = ThisWorkbook.Sheets("Jira backlog export")
    Set wsAssets = ThisWorkbook.Sheets("asset mapping")
    
    ' Find the last rows and columns in the sheets
    lastRowJira = wsJira.Cells(wsJira.Rows.Count, "A").End(xlUp).Row
    lastColJira = wsJira.Cells(1, wsJira.Columns.Count).End(xlToLeft).Column
    lastRowAssets = wsAssets.Cells(wsAssets.Rows.Count, "A").End(xlUp).Row

    ' Loop through each Asset ID in the asset mapping sheet
    For i = 2 To lastRowAssets ' Assuming the first row is a header
        component = wsAssets.Cells(i, 1).Value ' Asset ID is in column A

        ' Loop through each row in the Jira backlog export sheet
        For j = 2 To lastRowJira ' Assuming the first row is a header
            issueKey = wsJira.Cells(j, 1).Value ' Issue key is in column A

            ' Loop through each Component/s column in the current row
            For k = 2 To lastColJira ' Assuming the first column is Issue key
                If wsJira.Cells(1, k).Value Like "Component*" Then
                    If wsJira.Cells(j, k).Value = component Then
                        existingValue = wsAssets.Cells(i, "DG").Value
                        If existingValue = "" Then
                            wsAssets.Cells(i, "DG").Value = issueKey
                        Else
                            wsAssets.Cells(i, "DG").Value = existingValue & ", " & issueKey
                        End If
                        Exit For
                    End If
                End If
            Next k
        Next j
    Next i

    MsgBox "Correlating Jiras completed!"
End Sub
